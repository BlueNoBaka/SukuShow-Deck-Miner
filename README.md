# SukuShow Deck Miner

A deck simulator and optimizer for the rhythm game mode, School Idol Stage („Çπ„ÇØ„Ç∑„Éß„Ç¶), within [Link\! Like\! LoveLive\!](https://www.lovelive-anime.jp/hasunosora/system/) („É™„É≥„ÇØ„É©).

---

**[English](README.md) | [ÁÆÄ‰Ωì‰∏≠Êñá](README_zh-cn.md) | [Êó•Êú¨Ë™û](README_ja-jp.md)**

---

## üöÄ Quick Start

### üõû Prerequisites

- **Python Version**:  
  This project **requires Python 3.10 or newer** due to the use of `match ... case ...` statements.  
  **For optimal performance, running with Python 3.11 or later is highly recommended.**

- **Dependencies**:  

  - `PyYAML`
  - `tqdm`

  You can install them using the command below:

  ```bash
  pip install PyYAML tqdm
  ```

---

## üéÆ Usage

### ‚ñ∂ Run Core Scripts

Choose and run the following files based on your needs:

- `MainBatch.py`: **Batch Simulation**. Input your card pool and target song to automatically generate decks and run batch simulations to find the **optimal deck for a single song**.
- `MainSingle.py`: **Single Simulation**. Input a specific deck and target song to run a single simulation and output the detailed simulation process.
- `multi_song_optimizer.py`: **Multi-Song Optimization**. Input multiple target songs and use the deck scores generated by `MainBatch.py` to find the **optimal combination across multiple songs**.

### ‚öô Custom Configuration

You can adjust the configurations in the following files as needed:

- `CardLevelConfig.py`: Configure the **default levels** for all cards and **specific levels for individual cards** (`CARD_CACHE`). By default, all cards are set to max level.
- `DeckGen.py`: Handles deck generation logic. You can configure **card conflict rules** (`CARD_CONFLICT_RULES`) here to further optimize deck generation by pruning.

---

## ‚ö†Ô∏è **Important Warning: CPU Usage & Stability** ‚ö†Ô∏è

> [\!CAUTION]  
> ‚ö† **Batch simulations by default utilize all available CPU threads, and CPU usage typically exceeds 99% during runtime.** ‚ö†  
> **We've observed cases where an Intel i5-13600KF processor experienced a BSOD after prolonged full-load operation.**  
>
> If you are not confident in your CPU's stability or cooling, **it's highly recommended to take the following measures before running batch simulations**:
>
> - **Increase voltage / downclock** your CPU.
> - **Reduce the number of threads** used by the simulator.
>
> As a precautionary measure, you can modify the line `num_processes = os.cpu_count() or 1` in `MainBatch.py` to `num_processes = 12`. The value `12` is an example; you can replace it with **any other value less than your CPU's total thread count** to reduce performance pressure.

- **Resource Considerations**: Technically, you could include all available cards in the card pool for batch simulation. However, this demands **extremely powerful CPU performance, massive RAM, and ample simulation time**. Due to potential unforeseen issues, this approach is **not recommended**.
- **Memory Accumulation**: Although deck generation and simulation stages in batch processing operate as a pipeline, which somewhat alleviates immediate memory pressure, **the simulation results for all decks will accumulate in memory until completion**. Therefore, it's advised not to include too many cards in the card pool to prevent out-of-memory errors.

---

## üìù Notes & Potential Discrepancies

- This simulator uses an **exhaustive search method** for deck generation and simulation. The "optimal deck for a single song" found is only valid under the **given card pool, card levels, and difficulty**. It refers to the optimal score deck achieved by hitting **All Perfect** at the exact timing specified in the chart, or by AFK until mental drops below 10% (if the deck contains Party Ginko) and then maintaining All Perfect. Adjusting the card pool, training levels, or chart difficulty may yield different optimal decks.
- Similarly, the **optimal deck combination for multiple songs** will also vary with changes in card pool, card levels, difficulty, etc.
- The simulator effectively **saves time on in-game rehearsal**, but it's difficult to find the **absolute optimal deck** in a single attempt. A good understanding of card skills is required to fully utilize the simulator's potential.
- **Optimal Deck ‚â† Optimal Strategy**. For strategies involving precise timing, frame-by-frame scoring optimization, or adjusting card skill levels based on skill conditions/effects, please use your own discretion.
- When calculating **Grandprix Pt**, season fan levels are assumed to be **Lv. 10**, and the limitbreak multiplier for center character (if exists) is assumed to be **1.4x**.
- As the simulator **does not 1:1 perfectly replicate in-game logic**, it's normal for simulated scores to differ from actual in-game scores.

### ‚è∞ Possible Sources of Error

**Logic Inconsistencies**  
Failure to perfectly replicate the original game logic may lead to significant discrepancies in skill processing and score calculation results compared to actual play.
If you can provide **actual play recordings, detailed deck levels, and song Master Lv. information**, I might attempt to verify the inconsistencies and provide fixes.

**Missing Hold Note Judgment Points**  
Some charts may have a single-digit error in the number of parsed notes in the simulator, and some of which have not been manually corrected in `RChartPatch.py`.  
**Curved long notes** in charts are actually composed of multiple short straight Hold notes. However, their intermediate timestamps recorded in the chart may not perfectly match the actual judgment points in the game. The game re-segments Hold note timestamps at half-beat intervals.  
`RChart.py` replicates this logic, but due to **calculation precision or different calculation methods**, some Hold notes might be missing one judgment point.

**Time Processing Errors**  
Due to **floating-point precision issues** or other unknown reasons (for example, the game might process all events once per frame rather than precisely at each event's exact timestamp), **actual skill activation timing might be earlier/later** than simulated.  
In extreme cases, skills might activate just before Fever in simulation but only after Fever begins in actual play. This can result in Voltage/Score bonus being consumed by a Center Skill that triggers at Fever's start.  

**Judgment Timing**  
The simulator only processes notes at their precise `just` timing in the chart, regardless of whether the judgment is Perfect.
However, in-game judgment has a **time window**. When AP is not enough, this might cause skill activation timings in actual play to be slightly earlier/later, potentially leading to one more/less skill activation than in simulation in extreme cases.  
For notes that fall on the same beat as the start/end of Fever, frame-by-frame "optimizing" can sometimes allow them to receive the double Voltage bonus from Fever. However, the recorded timestamp of these notes in the chart is usually a few decimal places off from the actual Fever transition time, which might lead to them not being processed within Fever during simulation.  
The table below shows judgment timings as of Ver.4.0.1, for reference only:

<table>
  <thead>
    <tr>
      <th rowspan="2"><b>Judgement</b></th>
      <th colspan="3"><b>Judgement Timing (ms)</b></th>
    </tr>
    <tr>
      <th><i>Single / Hold</i></th>
      <th><i>Flick</i></th>
      <th><i>Trace</i></th>
    </tr>
  </thead>
  <tbody align="center">
    <tr>
      <td>Perfect</td>
      <td>0 ~ ¬±40</td>
      <td>0 ~ ¬±70</td>
      <td>0 ~ ¬±70</td>
    </tr>
    <tr>
      <td>Great</td>
      <td>¬±40 ~ ¬±70</td>
      <td>¬±70 ~ ¬±100</td>
      <td>Ôºç</td>
    </tr>
    <tr>
      <td>Good</td>
      <td>¬±70 ~ ¬±100</td>
      <td>Tap but no Up-Flick</td>
      <td>Ôºç</td>
    </tr>
    <tr>
      <td>Bad</td>
      <td>¬±100 ~ ¬±125</td>
      <td>Ôºç</td>
      <td>Ôºç</td>
    </tr>
    <tr>
      <td>Miss</td>
      <td>¬±125 ~</td>
      <td>¬±100 ~</td>
      <td>¬±70 ~</td>
    </tr>
  </tbody>
</table>
